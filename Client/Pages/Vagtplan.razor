@page "/vagtplan"
@inject HttpClient Http
@inject NavigationManager UriHelper
@inject AuthenticationStateProvider AuthenticationStateProvider

<AuthorizeView>
    <Authorized>

        <h2>Vagtplan</h2>
        <p>Liste over alle vagter</p>

        @if (taskList == null)
        {
            <p><em>Indlæser...</em></p>
        }
        else
        {
            <table class="table table-borderless table-openair table-hover">
                <thead>
                    <tr>
                        <th>Beskrivelse</th>
                        <th>Lokation</th>
                        <th>Frivillig</th>
                        <th>Start tid</th>
                        <th>Sluttid</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var task in taskList)
                    {

                        <tr>
                            <td>@task.description</td>
                            <td>@task.location</td>
                            <td>@task.volunteer</td>
                            <td>@task.starttime</td>
                            <td>@task.stoptime</td>
                        </tr>
                    }
                </tbody>

            </table>
        }

    </Authorized>
    <NotAuthorized>
        <p>Du har ikke adgang til denne side.</p>
    </NotAuthorized>
</AuthorizeView>

@code {
    private List<TaskClass> taskList;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
            taskList = await Http.GetFromJsonAsync<List<TaskClass>>("Task");
    }

}